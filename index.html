<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - Ø§Ù„Ù‡Ø§ØªÙ</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            direction: rtl;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        .container {
            max-width: 100%;
            padding: 10px;
        }
        
        .header {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .game-area {
            position: relative;
            width: 100%;
            height: 50vh;
            border: 3px solid #fff;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .camera-area {
            position: relative;
            width: 100%;
            height: 30vh;
            border: 2px solid #fff;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
        }
        
        #webcam {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        #outputCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .camera-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            z-index: 10;
        }
        
        .hand-point {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff00ff;
            border: 2px solid white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            display: none;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.8);
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            font-weight: bold;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        #startBtn { 
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        #resetBtn { 
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
        
        #cameraBtn { 
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .loading {
            text-align: center;
            padding: 10px;
            color: #ffeb3b;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .status-indicators {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .status {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status.game { background: rgba(76, 175, 80, 0.3); }
        .status.camera { background: rgba(156, 39, 176, 0.3); }
        .status.hand { background: rgba(255, 0, 255, 0.3); }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.3rem;
            }
            
            .stats {
                font-size: 0.8rem;
            }
            
            button {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .instructions {
                font-size: 0.8rem;
            }
            
            .game-area {
                height: 45vh;
            }
            
            .camera-area {
                height: 25vh;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.1rem;
            }
            
            .game-area {
                height: 40vh;
            }
            
            .camera-area {
                height: 22vh;
            }
            
            .status-indicators {
                flex-direction: column;
                gap: 5px;
            }
        }

        @media (min-width: 1024px) {
            .main-content {
                flex-direction: row;
                height: 60vh;
            }
            
            .game-area {
                height: 100%;
                flex: 2;
            }
            
            .camera-area {
                height: 100%;
                flex: 1;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„ÙŠØ¯ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .hand-detected {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
            <div class="stats">
                <div>Ø§Ù„Ø·ÙˆÙ„: <span id="length">0</span></div>
                <div>Ø§Ù„Ù†ØªÙŠØ¬Ø©: <span id="score">0</span></div>
                <div>Ø§Ù„Ø·Ø¹Ø§Ù…: <span id="foodCount">10</span></div>
            </div>
        </div>
        
        <div class="status-indicators">
            <div class="status game" id="gameStatus">â¹ï¸ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØªÙˆÙ‚ÙØ©</div>
            <div class="status camera" id="cameraStatus">ğŸ”´ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…ØªÙˆÙ‚ÙØ©</div>
            <div class="status hand" id="handStatus">âœ‹ Ø§Ù†ØªØ¸Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</div>
        </div>
        
        <div class="main-content">
            <div class="game-area">
                <canvas id="gameCanvas"></canvas>
            </div>
            
            <div class="camera-area">
                <video id="webcam" autoplay playsinline></video>
                <canvas id="outputCanvas"></canvas>
                <div class="camera-overlay">ÙƒØ§Ù…ÙŠØ±Ø§ ØªØªØ¨Ø¹ Ø§Ù„ÙŠØ¯</div>
                <div class="hand-point" id="handPoint"></div>
            </div>
        </div>
        
        <div class="controls">
            <button id="startBtn">ğŸ® Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            <button id="resetBtn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø¯Ø¡</button>
            <button id="cameraBtn">ğŸ“· ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
        </div>
        
        <div class="instructions">
            <h3>ğŸ¯ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨:</h3>
            <p>â€¢ Ø§Ø¶ØºØ· "ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§" ÙˆØ§Ø³Ù…Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</p>
            <p>â€¢ Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©" Ø«Ù… Ø­Ø±Ùƒ Ø¥ØµØ¨Ø¹ Ø§Ù„Ø³Ø¨Ø§Ø¨Ø© Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</p>
            <p>â€¢ ğŸ ÙƒÙ„ Ø¯Ø§Ø¦Ø±Ø© Ø­Ù…Ø±Ø§Ø¡ = 10 Ù†Ù‚Ø§Ø·</p>
            <p>â€¢ âš ï¸ ØªØ¬Ù†Ø¨ Ù„Ù…Ø³ Ø­ÙˆØ§Ù Ø§Ù„Ø´Ø§Ø´Ø©!</p>
        </div>
        
        <div class="loading" id="loadingText">
            â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ ØªØªØ¨Ø¹ Ø§Ù„ÙŠØ¯...
        </div>
    </div>

    <script>
        class SnakeGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.video = document.getElementById('webcam');
                this.outputCanvas = document.getElementById('outputCanvas');
                this.outputCtx = this.outputCanvas.getContext('2d');
                this.handPoint = document.getElementById('handPoint');
                
                // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                this.gameStatus = document.getElementById('gameStatus');
                this.cameraStatus = document.getElementById('cameraStatus');
                this.handStatus = document.getElementById('handStatus');
                this.loadingText = document.getElementById('loadingText');
                
                // Ø¶Ø¨Ø· Ø­Ø¬Ù… Canvas
                this.setupCanvasSize();
                
                // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
                this.points = [];
                this.lengths = [];
                this.currentLength = 0;
                this.allowedLength = 250;
                this.previousHead = { x: this.canvas.width / 2, y: this.canvas.height / 2 };
                this.score = 0;
                this.foodCount = 10;
                this.gameRunning = false;
                this.cameraActive = false;
                this.handDetector = null;
                this.camera = null;
                this.lastHandTime = 0;
                this.handDetectionActive = false;
                
                this.food = {
                    x: 0,
                    y: 0,
                    size: 20
                };
                
                this.randomFoodLocation();
                this.setupEventListeners();
                this.setupHandDetection();
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                this.gameLoop();
            }
            
            setupCanvasSize() {
                // Ø­Ø¬Ù… Ù„Ø¹Ø¨Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†
                const gameRect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = gameRect.width;
                this.canvas.height = gameRect.height;
                
                // Ø­Ø¬Ù… ÙƒØ§Ù…ÙŠØ±Ø§ ØªØªØ¨Ø¹ Ø§Ù„ÙŠØ¯
                const cameraRect = this.outputCanvas.parentElement.getBoundingClientRect();
                this.outputCanvas.width = cameraRect.width;
                this.outputCanvas.height = cameraRect.height;
            }
            
            setupEventListeners() {
                document.getElementById('startBtn').addEventListener('click', () => this.startGame());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetGame());
                document.getElementById('cameraBtn').addEventListener('click', () => this.toggleCamera());
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø­Ø¬Ù…
                window.addEventListener('resize', () => {
                    setTimeout(() => {
                        this.setupCanvasSize();
                        this.draw();
                    }, 100);
                });
                
                // ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ (Ø¨Ø¯ÙŠÙ„)
                this.canvas.addEventListener('touchmove', (e) => {
                    if (this.gameRunning && (!this.cameraActive || !this.handDetectionActive)) {
                        e.preventDefault();
                        const rect = this.canvas.getBoundingClientRect();
                        const touch = e.touches[0];
                        this.update({
                            x: touch.clientX - rect.left,
                            y: touch.clientY - rect.top
                        });
                    }
                }, { passive: false });
            }
            
            async setupHandDetection() {
                try {
                    this.loadingText.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ ØªØªØ¨Ø¹ Ø§Ù„ÙŠØ¯...';
                    
                    this.handDetector = new Hands({
                        locateFile: (file) => {
                            return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                        }
                    });
                    
                    this.handDetector.setOptions({
                        maxNumHands: 1,
                        modelComplexity: 1,
                        minDetectionConfidence: 0.7,
                        minTrackingConfidence: 0.7
                    });
                    
                    this.handDetector.onResults((results) => {
                        this.onHandResults(results);
                    });
                    
                    this.loadingText.innerHTML = 'âœ… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø§Ù‡Ø²! Ø§Ø¶ØºØ· "ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§"';
                    
                } catch (error) {
                    console.error('Error setting up hand detection:', error);
                    this.loadingText.innerHTML = 'âš ï¸ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù„Ù…Ø³ Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©';
                }
            }
            
            onHandResults(results) {
                this.outputCtx.save();
                this.outputCtx.clearRect(0, 0, this.outputCanvas.width, this.outputCanvas.height);
                
                // Ø±Ø³Ù… ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                this.outputCtx.drawImage(results.image, 0, 0, this.outputCanvas.width, this.outputCanvas.height);
                
                if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                    const landmarks = results.multiHandLandmarks[0];
                    
                    // Ø±Ø³Ù… Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠØ¯
                    drawConnectors(this.outputCtx, landmarks, HAND_CONNECTIONS, {
                        color: '#00FF00',
                        lineWidth: 3
                    });
                    drawLandmarks(this.outputCtx, landmarks, {
                        color: '#FF0000',
                        lineWidth: 2,
                        radius: 4
                    });
                    
                    // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ÙŠØ¯ Ø§Ù„Ø£Ø®ÙŠØ±
                    this.lastHandTime = Date.now();
                    this.handDetectionActive = true;
                    this.handStatus.innerHTML = 'âœ… ÙŠØ¯ Ù…ÙƒØªØ´ÙØ© - Ø­Ø±Ùƒ Ø¥ØµØ¨Ø¹Ùƒ!';
                    this.handStatus.style.background = 'rgba(76, 175, 80, 0.3)';
                    
                    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ¶Ø¹ Ø¥ØµØ¨Ø¹ Ø§Ù„Ø³Ø¨Ø§Ø¨Ø© (Landmark 8)
                    const indexFinger = landmarks[8];
                    if (indexFinger) {
                        const x = indexFinger.x * this.outputCanvas.width;
                        const y = indexFinger.y * this.outputCanvas.height;
                        
                        // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ù…Ø±Ø¦ÙŠØ©
                        this.handPoint.style.display = 'block';
                        this.handPoint.style.left = (x - 10) + 'px';
                        this.handPoint.style.top = (y - 10) + 'px';
                        this.handPoint.classList.add('hand-detected');
                        
                        // ØªØ­ÙˆÙŠÙ„ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¥Ù„Ù‰ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
                        if (this.gameRunning && this.cameraActive) {
                            const gameX = (x / this.outputCanvas.width) * this.canvas.width;
                            const gameY = (y / this.outputCanvas.height) * this.canvas.height;
                            this.update({ 
                                x: Math.max(15, Math.min(this.canvas.width - 15, gameX)),
                                y: Math.max(15, Math.min(this.canvas.height - 15, gameY))
                            });
                        }
                    }
                } else {
                    this.handDetectionActive = false;
                    this.handPoint.style.display = 'none';
                    this.handPoint.classList.remove('hand-detected');
                    this.handStatus.innerHTML = 'âœ‹ Ø¶Ø¹ ÙŠØ¯Ùƒ Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
                    this.handStatus.style.background = 'rgba(255, 0, 255, 0.3)';
                }
                
                this.outputCtx.restore();
            }
            
            async toggleCamera() {
                if (!this.cameraActive) {
                    await this.startCamera();
                } else {
                    this.stopCamera();
                }
            }
            
            async startCamera() {
                try {
                    this.loadingText.innerHTML = 'ğŸ“· Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...';
                    
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            facingMode: 'user',
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            frameRate: { ideal: 30 }
                        }
                    });
                    
                    this.video.srcObject = stream;
                    this.cameraActive = true;
                    this.cameraStatus.innerHTML = "âœ… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø´Ø·Ø©";
                    this.cameraStatus.style.background = "rgba(76, 175, 80, 0.3)";
                    document.getElementById('cameraBtn').innerHTML = 'ğŸ“· Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
                    this.loadingText.innerHTML = 'ğŸ¯ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¹Ù…Ù„ - Ø­Ø±Ùƒ Ø¥ØµØ¨Ø¹Ùƒ Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§!';
                    
                    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØªØ¨Ø¹
                    this.camera = new Camera(this.video, {
                        onFrame: async () => {
                            if (this.handDetector && this.cameraActive) {
                                await this.handDetector.send({ image: this.video });
                            }
                        },
                        width: this.outputCanvas.width,
                        height: this.outputCanvas.height
                    });
                    await this.camera.start();
                    
                } catch (error) {
                    console.error('Error starting camera:', error);
                    this.loadingText.innerHTML = 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.';
                    this.cameraActive = false;
                }
            }
            
            stopCamera() {
                if (this.camera) {
                    this.camera.stop();
                    this.camera = null;
                }
                
                if (this.video.srcObject) {
                    this.video.srcObject.getTracks().forEach(track => track.stop());
                    this.video.srcObject = null;
                }
                
                this.cameraActive = false;
                this.handDetectionActive = false;
                this.cameraStatus.innerHTML = "ğŸ”´ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…ØªÙˆÙ‚ÙØ©";
                this.cameraStatus.style.background = "rgba(244, 67, 54, 0.3)";
                this.handStatus.innerHTML = "âœ‹ Ø§Ù†ØªØ¸Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§";
                this.handStatus.style.background = "rgba(255, 0, 255, 0.3)";
                document.getElementById('cameraBtn').innerHTML = 'ğŸ“· ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
                this.handPoint.style.display = 'none';
                this.loadingText.innerHTML = 'ğŸ’¡ Ø§Ø¶ØºØ· "ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§" Ù„Ù„Ø¨Ø¯Ø¡';
                
                // Ù…Ø³Ø­ canvas Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                this.outputCtx.clearRect(0, 0, this.outputCanvas.width, this.outputCanvas.height);
            }
            
            randomFoodLocation() {
                this.food.x = Math.random() * (this.canvas.width - 60) + 30;
                this.food.y = Math.random() * (this.canvas.height - 60) + 30;
            }
            
            startGame() {
                this.gameRunning = true;
                this.points = [{ x: this.canvas.width / 2, y: this.canvas.height / 2 }];
                this.lengths = [];
                this.currentLength = 0;
                this.score = 0;
                this.foodCount = 10;
                this.previousHead = { x: this.canvas.width / 2, y: this.canvas.height / 2 };
                this.updateStats();
                this.gameStatus.innerHTML = "ğŸ® Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù…Ù„";
                this.gameStatus.style.background = "rgba(76, 175, 80, 0.3)";
            }
            
            resetGame() {
                this.gameRunning = false;
                this.points = [];
                this.score = 0;
                this.foodCount = 10;
                this.updateStats();
                this.gameStatus.innerHTML = "â¹ï¸ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØªÙˆÙ‚ÙØ©";
                this.gameStatus.style.background = "rgba(76, 175, 80, 0.3)";
            }
            
            updateStats() {
                document.getElementById('length').textContent = Math.floor(this.currentLength);
                document.getElementById('score').textContent = this.score;
                document.getElementById('foodCount').textContent = this.foodCount;
            }
            
            update(currentHead) {
                if (!this.gameRunning) return;
                
                const px = this.previousHead.x;
                const py = this.previousHead.y;
                const cx = currentHead.x;
                const cy = currentHead.y;
                
                this.points.push({ x: cx, y: cy });
                const distance = Math.hypot(cx - px, cy - py);
                this.lengths.push(distance);
                this.currentLength += distance;
                this.previousHead = { x: cx, y: cy };
                
                // ØªÙ‚Ù„ÙŠÙ„ Ø·ÙˆÙ„ Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†
                if (this.currentLength > this.allowedLength) {
                    for (let i = 0; i < this.lengths.length; i++) {
                        this.currentLength -= this.lengths[i];
                        this.lengths.splice(i, 1);
                        this.points.splice(i, 1);
                        if (this.currentLength < this.allowedLength) break;
                    }
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£ÙƒÙ„ Ø§Ù„Ø·Ø¹Ø§Ù…
                if (Math.abs(cx - this.food.x) < this.food.size + 10 && 
                    Math.abs(cy - this.food.y) < this.food.size + 10) {
                    this.randomFoodLocation();
                    this.allowedLength += 25;
                    this.score += 10;
                    this.foodCount--;
                    this.updateStats();
                    
                    if (this.foodCount <= 0) {
                        this.gameWon();
                    }
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†
                if (cx < 5 || cx > this.canvas.width - 5 || cy < 5 || cy > this.canvas.height - 5) {
                    this.gameOver();
                }
            }
            
            draw() {
                // Ù…Ø³Ø­ Canvas
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Ø±Ø³Ù… Ø´Ø¨ÙƒØ© Ø®Ù„ÙÙŠØ©
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                this.ctx.lineWidth = 1;
                const size = 30;
                for (let x = 0; x < this.canvas.width; x += size) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }
                for (let y = 0; y < this.canvas.height; y += size) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }
                
                // Ø±Ø³Ù… Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†
                if (this.points.length > 0) {
                    this.drawSnake();
                }
                
                // Ø±Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù…
                this.drawFood();
                
                // Ø±Ø³Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
                this.drawUI();
            }
            
            drawSnake() {
                // Ø±Ø³Ù… Ø®Ø· Ø§Ù„Ø¬Ø³Ù…
                this.ctx.strokeStyle = '#00ff00';
                this.ctx.lineWidth = 8;
                this.ctx.lineCap = 'round';
                this.ctx.lineJoin = 'round';
                this.ctx.beginPath();
                this.ctx.moveTo(this.points[0].x, this.points[0].y);
                
                for (let i = 1; i < this.points.length; i++) {
                    this.ctx.lineTo(this.points[i].x, this.points[i].y);
                }
                this.ctx.stroke();
                
                // Ø±Ø³Ù… Ø§Ù„Ø±Ø£Ø³
                const head = this.points[this.points.length - 1];
                const gradient = this.ctx.createRadialGradient(
                    head.x, head.y, 5,
                    head.x, head.y, 20
                );
                gradient.addColorStop(0, '#ff00ff');
                gradient.addColorStop(1, '#9900cc');
                
                this.ctx.fillStyle = gradient;
                this.ctx.beginPath();
                this.ctx.arc(head.x, head.y, 15, 0, Math.PI * 2);
                this.ctx.fill();
                
                // Ø¹ÙŠÙˆÙ† Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†
                this.ctx.fillStyle = 'white';
                this.ctx.beginPath();
                this.ctx.arc(head.x - 6, head.y - 6, 4, 0, Math.PI * 2);
                this.ctx.arc(head.x + 6, head.y - 6, 4, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.fillStyle = 'black';
                this.ctx.beginPath();
                this.ctx.arc(head.x - 6, head.y - 6, 2, 0, Math.PI * 2);
                this.ctx.arc(head.x + 6, head.y - 6, 2, 0, Math.PI * 2);
                this.ctx.fill();
            }
            
            drawFood() {
                const gradient = this.ctx.createRadialGradient(
                    this.food.x, this.food.y, 5,
                    this.food.x, this.food.y, this.food.size
                );
                gradient.addColorStop(0, '#ff6b6b');
                gradient.addColorStop(1, '#ee5a24');
                
                this.ctx.fillStyle = gradient;
                this.ctx.beginPath();
                this.ctx.arc(this.food.x, this.food.y, this.food.size, 0, Math.PI * 2);
                this.ctx.fill();
                
                // ØªØ£Ø«ÙŠØ± Ø¨Ø±ÙŠÙ‚
                this.ctx.strokeStyle = 'rgba(255, 255, 0, 0.6)';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(this.food.x, this.food.y, this.food.size + 5, 0, Math.PI * 2);
                this.ctx.stroke();
            }
            
            drawUI() {
                // Ø±Ø³Ù… Ø§Ù„Ù†Ù‚Ø§Ø·
                this.ctx.fillStyle = 'white';
                this.ctx.font = 'bold 16px Arial';
                this.ctx.textAlign = 'left';
                this.ctx.fillText(`Ø§Ù„Ù†Ù‚Ø§Ø·: ${this.score}`, 10, 25);
                this.ctx.fillText(`Ø§Ù„Ø·Ø¹Ø§Ù…: ${this.foodCount}`, 10, 50);
                
                // Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­ÙƒÙ…
                if (!this.cameraActive) {
                    this.ctx.textAlign = 'center';
                    this.ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                    this.ctx.font = '14px Arial';
                    this.ctx.fillText('Ø´ØºÙ‘Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„Ù…Ø³ Ù„Ù„ØªØ­ÙƒÙ…', this.canvas.width / 2, this.canvas.height - 20);
                }
            }
            
            gameLoop() {
                this.draw();
                requestAnimationFrame(() => this.gameLoop());
            }
            
            gameOver() {
                this.gameRunning = false;
                this.ctx.fillStyle = 'rgba(255, 0, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.ctx.fillStyle = 'white';
                this.ctx.font = 'bold 30px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!', this.canvas.width / 2, this.canvas.height / 2 - 30);
                this.ctx.font = '24px Arial';
                this.ctx.fillText(`Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${this.score}`, this.canvas.width / 2, this.canvas.height / 2 + 20);
                
                this.gameStatus.innerHTML = "ğŸ’€ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©";
                this.gameStatus.style.background = "rgba(244, 67, 54, 0.3)";
            }
            
            gameWon() {
                this.gameRunning = false;
                this.ctx.fillStyle = 'rgba(0, 255, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.ctx.fillStyle = 'white';
                this.ctx.font = 'bold 30px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('ğŸ‰ ÙØ²Øª ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©!', this.canvas.width / 2, this.canvas.height / 2);
                
                this.gameStatus.innerHTML = "ğŸ† ÙØ²Øª ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©!";
                this.gameStatus.style.background = "rgba(255, 193, 7, 0.3)";
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', () => {
            new SnakeGame();
        });
        
        // Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        document.addEventListener('touchmove', (e) => {
            if (e.target.tagName !== 'BUTTON') {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>